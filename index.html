<!DOCTYPE html>
<html lang="zh-CN,en,default">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/favicon-logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"l1dan.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null,"activeClass":"valine"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="帮助自己成长，如有不对还望斧正。">
<meta property="og:type" content="website">
<meta property="og:title" content="l1Dan&#39;s blog">
<meta property="og:url" content="https://l1dan.github.io/index.html">
<meta property="og:site_name" content="l1Dan&#39;s blog">
<meta property="og:description" content="帮助自己成长，如有不对还望斧正。">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="李丹(l1dan@hotmail.com)">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://l1dan.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>l1Dan's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">l1Dan's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">日常记录，坐标深圳</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/l1Dan" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN,en,default">
    <link itemprop="mainEntityOfPage" href="https://l1dan.github.io/2021/05/03/2021-05-03-apple-objective-c-style-guide/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="李丹(l1dan@hotmail.com)">
      <meta itemprop="description" content="帮助自己成长，如有不对还望斧正。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="l1Dan's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/03/2021-05-03-apple-objective-c-style-guide/" class="post-title-link" itemprop="url">Objective-C 样式指南</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-03 11:21:56" itemprop="dateCreated datePublished" datetime="2021-05-03T11:21:56+08:00">2021-05-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-23 21:35:26" itemprop="dateModified" datetime="2021-05-23T21:35:26+08:00">2021-05-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a>
                </span>
            </span>

          
            <span id="/2021/05/03/2021-05-03-apple-objective-c-style-guide/" class="post-meta-item leancloud_visitors" data-flag-title="Objective-C 样式指南" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/05/03/2021-05-03-apple-objective-c-style-guide/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/05/03/2021-05-03-apple-objective-c-style-guide/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Objective-C-样式指南"><a href="#Objective-C-样式指南" class="headerlink" title="Objective-C 样式指南"></a>Objective-C 样式指南</h1><p>本样式指南概述了 iOS 团队使用的编码规范，使用 Objective-C 语言的开发人员都应按照本样式指南编写代码。</p>
<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>以下是 Apple 官方提供的有关样式指南的文档。如果此处未提及某些内容，下面的文档中也能找到详细介绍内容：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/ProgrammingWithObjectiveC/Introduction/Introduction.html">Objective-C 编程语言</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/CocoaFundamentals/Introduction/Introduction.html">Cocoa 入门指南</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/CodingGuidelines/CodingGuidelines.html">Cocoa 编码规范</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/technologies">Apple Developer 技术指南</a></li>
</ul>
<h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ul>
<li><a href="#%E5%8F%AF%E7%A9%BA%E6%80%A7">可空性</a></li>
<li><a href="#%E7%82%B9%E8%AF%AD%E6%B3%95">点语法</a></li>
<li><a href="#%E4%BB%A3%E7%A0%81%E5%AE%BD%E5%BA%A6%E9%99%90%E5%88%B6">代码宽度限制</a></li>
<li><a href="#%E4%BB%A3%E7%A0%81%E7%BB%84%E7%BB%87">代码组织</a></li>
<li><a href="#%E7%A9%BA%E8%A1%8C%E4%B8%8E%E7%BC%A9%E8%BF%9B">空行与缩进</a></li>
<li><a href="#%E6%8B%AC%E5%8F%B7">括号</a></li>
<li><a href="#%E6%9D%A1%E4%BB%B6%E8%AF%AD%E5%8F%A5">条件语句</a></li>
<li><a href="#%E4%B8%89%E7%9B%AE%E8%BF%90%E7%AE%97%E7%AC%A6">三目运算符</a></li>
<li><a href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86">错误处理</a></li>
<li><a href="#%E6%96%B9%E6%B3%95">方法</a></li>
<li><a href="#%E6%9E%9A%E4%B8%BE">枚举</a></li>
<li><a href="#%E5%B1%9E%E6%80%A7">属性</a></li>
<li><a href="#%E5%91%BD%E5%90%8D">命名</a></li>
<li><a href="#%E4%B8%8B%E5%88%92%E7%BA%BF">下划线</a></li>
<li><a href="#%E6%B3%A8%E9%87%8A">注释</a></li>
<li><a href="#%E5%8D%8F%E8%AE%AE">协议</a></li>
<li><a href="#init-and-dealloc">Init &amp; Dealloc</a></li>
<li><a href="#instancetype-vs-id">instancetype vs id</a></li>
<li><a href="#alloc-init-vs-new">alloc-init vs new</a></li>
<li><a href="#%E5%AD%97%E9%9D%A2%E9%87%8F">字面量</a></li>
<li><a href="#CGRect-%E5%87%BD%E6%95%B0">CGRect 函数</a></li>
<li><a href="#%E5%B8%B8%E9%87%8F">常量</a></li>
<li><a href="#%E7%A7%81%E6%9C%89%E5%B1%9E%E6%80%A7">私有属性</a></li>
<li><a href="#%E7%A7%81%E6%9C%89%E5%A4%B4%E6%96%87%E4%BB%B6">私有头文件</a></li>
<li><a href="#%E5%B8%83%E5%B0%94%E5%80%BC">布尔值</a></li>
<li><a href="#%E4%BB%A3%E7%A0%81%E5%9D%97">代码块</a></li>
<li><a href="#%E5%8D%95%E4%BE%8B">单例</a></li>
<li><a href="#Xcode-%E9%A1%B9%E7%9B%AE">Xcode 项目</a></li>
<li><a href="#%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96">代码格式化</a></li>
</ul>
<hr>
<h2 id="可空性"><a href="#可空性" class="headerlink" title="可空性"></a>可空性</h2><p>从 Xcode 6.3 开始，Apple 已向 Objective-C 编译器引入了可空性注解。这允许开发者使用更具表现力的 API，也加强了 Swift 编译器理解 Objective-C 代码的能力，同时也提供给开发者更友好的编译器提示信息，我们希望对所有代码强制使用此注解。</p>
<p>注解的使用非常简单。我们采用的标准是在所有头文件使用 <code>NS_ASSUME_NONNULL_BEGIN</code> 和 <code>NS_ASSUME_NONNULL_END</code> 宏「Xcode 创建 Objective-C 文件时会自动添加」，然后标识可以为空的指针。</p>
<p>示例代码：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// XYZPerson.h</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">NS_ASSUME_NONNULL_BEGIN</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="built_in">NS_ENUM</span>(<span class="built_in">NSUInteger</span>, XYZPersonGenderType) &#123;</span><br><span class="line">    XYZPersonGenderTypeMale,</span><br><span class="line">    XYZPersonGenderTypeFemale</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">XYZPerson</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">XYZPersonDelegate</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)person:(Person *)person sayHello:(<span class="keyword">nullable</span> <span class="built_in">NSString</span> *)greeting;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">XYZPerson</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *firstName; <span class="comment">// 默认不为空</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>, <span class="keyword">nullable</span>) <span class="built_in">NSString</span> *lastName; <span class="comment">// 可以为空</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>, <span class="keyword">readonly</span>) XYZPersonGenderType genderType;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 弱属性必须可以为空。如果程序员从未将其设置为 nil，编译器将不会提示警告。如果未标注为可为空，Runtime 最后还是会将属性设置为 nil。</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">weak</span>, <span class="keyword">nullable</span>) <span class="keyword">id</span>&lt;XYZPersonDelegate&gt; delegate;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithFirstName:(<span class="built_in">NSString</span> *)firstName</span><br><span class="line">                         lastName:(<span class="keyword">nullable</span> <span class="built_in">NSString</span> *)lastName</span><br><span class="line">                       genderType:(XYZPersonGenderType)genderType <span class="built_in">NS_DESIGNATED_INITIALIZER</span>;</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">instancetype</span>)personWithFirstName:(<span class="built_in">NSString</span> *)firstName</span><br><span class="line">                           lastName:(<span class="keyword">nullable</span> <span class="built_in">NSString</span> *)lastName</span><br><span class="line">                         genderType:(XYZPersonGenderType)genderType;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">NS_ASSUME_NONNULL_END</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// XYZPerson.m</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">NS_ASSUME_NONNULL_BEGIN</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 不要忘记在 Extension 和 Category 中添加这一组宏</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">XYZPerson</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *fullName;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) GenderType genderType;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">NS_ASSUME_NONNULL_END</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">XYZPerson</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">instancetype</span>)init &#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">self</span> initWithFirstName:<span class="string">@&quot;&quot;</span> lastName:<span class="literal">nil</span> genderType:XYZPersonGenderTypeMale];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithFirstName:(<span class="built_in">NSString</span> *)firstName</span><br><span class="line">                         lastName:(<span class="keyword">nullable</span> <span class="built_in">NSString</span> *)lastName</span><br><span class="line">                       genderType:(XYZPersonGenderType)genderType &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        _firstName = firstName;</span><br><span class="line">        _lastName = lastName;</span><br><span class="line">        _genderType = genderType;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">instancetype</span>)personWithFirstName:(<span class="built_in">NSString</span> *)firstName</span><br><span class="line">                           lastName:(<span class="keyword">nullable</span> <span class="built_in">NSString</span> *)lastName</span><br><span class="line">                         genderType:(XYZPersonGenderType)genderType &#123;</span><br><span class="line">    <span class="keyword">return</span> [[<span class="keyword">self</span> alloc] initWithFirstName:firstName lastName:lastName genderType:genderType];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<p>注解方式并不复杂，但是有几点需要注意：</p>
<ul>
<li>注解无法改变编写的代码的逻辑，仅仅是 IDE 提供编译器辅助开发者的一种手段，我们应当合理利用。</li>
<li><code>weak</code> 属性: 如果不设置为 <code>nullable</code>，那么 API 不能完整表达 <code>weak</code> 属性的意图，并且如果显示地将属性设置为 <code>nil</code> 时，编译器会提示警告。</li>
<li>在接口声明之外使用可空性注解几乎没有任何意义。</li>
</ul>
<p>可空性只是编译器的特性。这也意味着运行时代码不会被更改。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NS_ASSUME_NONNULL_BEGIN</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> : <span class="title">UIViewController</span></span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *nonNullString;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">NS_ASSUME_NONNULL_END</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="built_in">NSString</span> *aString = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@&quot;helloworld %.1f&quot;</span>,<span class="number">1.0</span>];</span><br><span class="line">aString = <span class="literal">nil</span>;</span><br><span class="line">controller.nonNullString = aString; <span class="comment">// 正常</span></span><br><span class="line">controller.nonNullString = <span class="literal">nil</span>; <span class="comment">// 警告</span></span><br></pre></td></tr></table></figure>
<p>属性如果没有明确添加 <code>nonnull</code>，默认就是 <code>nonnull</code>。但是添加了 <code>nonnull</code> 的注解并不表示不能复制为 <code>nil</code>，虽然在代码中显示设置属性为 <code>nil</code> 时会提示警告信息，但是间接设置编译器却无法提示。为了保证运行的稳定，我们还是需要检查对象是否为 <code>nil</code>。</p>
<hr>
<h2 id="点语法"><a href="#点语法" class="headerlink" title="点语法"></a>点语法</h2><p>点语法应该<strong>总是</strong>用于访问和修改属性。另外的情况应该选择方括号「中括号」语法。</p>
<p><strong>推荐:</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">view.backgroundColor = [<span class="built_in">UIColor</span> orangeColor];</span><br><span class="line">[<span class="built_in">UIApplication</span> sharedApplication].delegate;</span><br></pre></td></tr></table></figure>

<p><strong>不推荐:</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[view setBackgroundColor:[<span class="built_in">UIColor</span> orangeColor]];</span><br><span class="line"><span class="built_in">UIApplication</span>.sharedApplication.delegate;</span><br></pre></td></tr></table></figure>

<p>使用 Objective-C 语言，不推荐使用点语法来访问其他方法。点语法只是语法糖，因此这样调用方法也是可以正常运行的。</p>
<p><strong>不可取:</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UIApplication</span> *application = <span class="built_in">UIApplication</span>.sharedApplication</span><br></pre></td></tr></table></figure>
<p>方括号「中括号」语法可以用来访问 <a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/ProgrammingWithObjectiveC/EncapsulatingData/EncapsulatingData.html#//apple_ref/doc/uid/TP40011210-CH5-SW2">getter 方法</a>:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">getter</span>=isFinished) <span class="built_in">BOOL</span> finished;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ([operation isFinished]) <span class="comment">// 推荐</span></span><br><span class="line"><span class="keyword">if</span> (operation.finished) <span class="comment">// 推荐</span></span><br><span class="line"><span class="keyword">if</span> (operation.isFinished) <span class="comment">// 不可取</span></span><br></pre></td></tr></table></figure>

<h2 id="代码宽度限制"><a href="#代码宽度限制" class="headerlink" title="代码宽度限制"></a>代码宽度限制</h2><p>虽然有业界约定俗成的代码宽度为 80 个字符，但这是因为早期很多 IDE 默认没有自动换行，或者换行之后有一些问题，故设置为 80 个字符比较适合。但是随着现在屏幕像素的不断提升，80 个字符的代码宽度确实有些浪费屏幕了。我们强制不规定代码的宽度，如果一定需要的话设置为 120 个字符会比较适合。</p>
<p>即使我们限制代码的宽度，也要需要注意代码宽度，方法调用和声明「因为 Objective-C 确实很冗长」太长也需要换行对齐，保持代码美观。</p>
<h2 id="代码组织"><a href="#代码组织" class="headerlink" title="代码组织"></a>代码组织</h2><ul>
<li>使用预处理指令 <code>#pragma mark - </code> 来分门别类，将功能划分不同的组，力求使用简短的描述性名称，并尽量不要省略名称「例如 #pragma mark - 」。</li>
<li>使用预处理指令 <code>#pragma mark </code> 来处理分组里面更加详细的功能。</li>
<li>Xcode 中使用 <code>Control + 6</code> 快捷键可以快速查看分组列表结构。</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> mark - Overwrite <span class="comment">// 重写系统方法列表</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> mark Lifecycle <span class="comment">// 生命周期方法列表「没有 “-” 连接符号」</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">instancetype</span>)init &#123;&#125;</span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;&#125;</span><br><span class="line">- (<span class="keyword">void</span>)viewWillAppear:(<span class="built_in">BOOL</span>)animated &#123;&#125;</span><br><span class="line">- (<span class="keyword">void</span>)didReceiveMemoryWarning &#123;&#125;</span><br><span class="line">- (<span class="keyword">void</span>)dealloc &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> mark NSCopying</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>)copyWithZone:(<span class="built_in">NSZone</span> *)zone &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> mark NSObject</span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSString</span> *)description &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 私有方法列表</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> mark - Private</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)privateMethod &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 协议、代理、数据源方法列表</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> mark - Protocol conformance</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> mark - UITextFieldDelegate</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> mark - UITableViewDataSource</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> mark - UITableViewDelegate</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> mark - Actions</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)clickSubmitButton:(<span class="keyword">id</span>)button &#123; &#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)clickLoginButton:(<span class="keyword">id</span>)button &#123; &#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)networkStatusDidChangeNotification:(<span class="built_in">NSNotification</span> *)notification &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> mark - Getter &amp; Setter</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)setCustomProperty:(<span class="keyword">id</span>)value &#123;&#125;</span><br><span class="line">- (<span class="keyword">id</span>)customProperty &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 公开方法列表</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> mark - Public</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)publicMethod &#123;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="空白-amp-缩进"><a href="#空白-amp-缩进" class="headerlink" title="空白 &amp; 缩进"></a>空白 &amp; 缩进</h2><ul>
<li>使用 4 个空格缩进，禁止使用制表符缩进，只需保持 Xcode 偏好设置中默认缩进即可。</li>
<li>在方法之间应该有需要有一空行，以帮助提高代码可读性和代码组织性，每个方法之间禁止空出多个空白行。</li>
<li>指针类型的星号<code>*</code>应与变量名称相邻「指针符号靠右」，而不是靠近前面的类型。适用于所有使用到的地方，包括「属性，局部变量，常量，方法类型等」。</li>
</ul>
<p><strong>推荐:</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSString</span> *message = <span class="built_in">NSLocalizedString</span>(<span class="string">@&quot;home.intro.message&quot;</span>, <span class="literal">nil</span>);</span><br></pre></td></tr></table></figure>
<p><strong>不可取:</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSString</span>* message = <span class="built_in">NSLocalizedString</span>(<span class="string">@&quot;home.intro.message&quot;</span>, <span class="literal">nil</span>);</span><br></pre></td></tr></table></figure>
<h2 id="括号"><a href="#括号" class="headerlink" title="括号"></a>括号</h2><p>花括号「大括号」在程序分支结构中的使用「<code>if</code>/<code>else</code>/<code>switch</code>/<code>while</code>」:</p>
<p><strong>推荐:</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ([user isHappy]) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)myMethod &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>不可取:</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ([user isHappy]) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)myMethod</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="条件语句"><a href="#条件语句" class="headerlink" title="条件语句"></a>条件语句</h2><p>即使代码体中是有一行代码也应始终使用括号包裹，以防止出错。这些错误包括添加第二行时，忘记加上括号包裹代码而导致。如果在 if 语句的代码体「第一行」被注释掉，那么下一行就成为 if 语句的一部分，这就会导致严重的错误。此外这个规则与所有其他条件一致，更便于维护代码。</p>
<p><strong>推荐:</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!error) &#123;</span><br><span class="line">    <span class="keyword">return</span> success;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>不可取:</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!error)</span><br><span class="line">    <span class="keyword">return</span> success;</span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!error) <span class="keyword">return</span> success;</span><br></pre></td></tr></table></figure>
<p>如果对于此规则无感，请参阅 <a target="_blank" rel="noopener" href="https://www.imperialviolet.org/2014/02/22/applebug.html">Apple SSL bug</a> 问题。</p>
<p>始终避免 <a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903603778355214">Yoda 条件</a> </p>
<p><strong>推荐:</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (number == <span class="number">7</span>) &#123; &#125;</span><br><span class="line"><span class="keyword">if</span> ([value isEqual:constant]) &#123; ...</span><br></pre></td></tr></table></figure>

<p><strong>不可取:</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="number">7</span> == number) &#123; &#125;</span><br><span class="line"><span class="keyword">if</span> ([constant isEqual:value]) &#123; ...</span><br></pre></td></tr></table></figure>

<p>可以先处理复杂的表达式，将处理结果作为条件，便于提高可读性。</p>
<p><em><strong>推荐:</strong></em></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">BOOL</span> stateForDismissalIsCorrect = [object something] &amp;&amp; [object somethingElse] &amp;&amp; ithinkSo;</span><br><span class="line"><span class="keyword">if</span> (stateForDismissalIsCorrect) &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em><strong>重构:</strong></em></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ([object something] &amp;&amp; [object somethingElse] &amp;&amp; ithinkSo) &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>检查「@optional」方法时，不需要检查代理是否存在：</p>
<p><strong>推荐:</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ([<span class="keyword">self</span>.delegate respondsToSelector:<span class="keyword">@selector</span>(...)]) &#123; </span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>不推荐:</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">self</span>.delegate &amp;&amp; [<span class="keyword">self</span>.delegate respondsToSelector:<span class="keyword">@selector</span>(...)]) &#123; </span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="三目运算符"><a href="#三目运算符" class="headerlink" title="三目运算符"></a>三目运算符</h2><p>三元运算符 <code>?</code>，可以增加清晰度和代码整洁度。通常用于判断单个条件。判断多个条件时可以重构使用 <code>if</code> 语句判断代码，这样逻辑会更加清晰易懂。</p>
<p><strong>推荐:</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">result = a &gt; b ? x : y;</span><br><span class="line">string = fromServer ?: <span class="string">@&quot;hardcoded&quot;</span>;</span><br></pre></td></tr></table></figure>

<p><strong>不推荐:</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">result = a &gt; b ? x = c &gt; d ? c : d : y;</span><br></pre></td></tr></table></figure>

<h2 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h2><p>当方法通过引用返回错误参数时，请使用接受的返回值作为判断依据，而不是使用错误变量判断。</p>
<p><strong>推荐:</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSError</span> *error;</span><br><span class="line"><span class="keyword">if</span> (![<span class="keyword">self</span> trySomethingWithError:&amp;error]) &#123;</span><br><span class="line">    <span class="comment">// 错误处理</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSError</span> *error;</span><br><span class="line"><span class="built_in">NSData</span> *data = [<span class="built_in">NSJSONSerialization</span> dataWithJSONObject:object options:<span class="built_in">NSJSONWritingPrettyPrinted</span> error:&amp;error];</span><br><span class="line"><span class="keyword">if</span> (data) &#123;</span><br><span class="line">     <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>不推荐:</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSError</span> *error;</span><br><span class="line">[<span class="keyword">self</span> trySomethingWithError:&amp;error];</span><br><span class="line"><span class="keyword">if</span> (error) &#123;</span><br><span class="line">    <span class="comment">// 错误处理</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在成功的情况下，某些 Apple 的 API 会将垃圾值写入错误参数「错误如果为非 NULL」，如果这样判断错误就会导致误报「可能会产生崩溃」。</p>
<h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><p>在方法签名中，作用域「-/+ 符号」后应有一个空格，形参与方法签名也有一个空格。</p>
<p><strong>推荐:</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)setExampleText:(<span class="built_in">NSString</span> *)text image:(<span class="built_in">UIImage</span> *)image;</span><br></pre></td></tr></table></figure>

<p><strong>不推荐:</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-(<span class="keyword">void</span>)setExampleText: (<span class="built_in">NSString</span> *)text image: (<span class="built_in">UIImage</span> *)image;</span><br></pre></td></tr></table></figure>

<p>私有方法没有特殊要求，可以将它们命名为常规方法，但不要使用下划线前缀，因为下划线 <code>_</code> 开头的方法是<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/CodingGuidelines/Articles/NamingMethods.html#//apple_ref/doc/uid/20001282-1003829-BCIBDJCA">保留给 Apple SDK 内部使用的</a>。</p>
<p>在类实现中，方法与方法之间应该有空行，@implementation 前后应有空行。<code>#pragma mark</code> 前后都要有空行。</p>
<p><em><strong>推荐:</strong></em></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">XYZPersonViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">weak</span>) <span class="built_in">UIButton</span> *settingsButton;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">XYZPersonViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> mark - LifeCycle</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidAppear:(<span class="built_in">BOOL</span>)animated &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> mark - Settings</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)goToSettings:(<span class="keyword">id</span>)sender &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="枚举"><a href="#枚举" class="headerlink" title="枚举"></a>枚举</h2><ul>
<li>使用 Objective-C 2.0 风格，枚举应使用 <code>NS_ENUM</code> 宏声明。</li>
<li>此外，在编写 <code>NS_ENUM</code> case 名称时，请使用易于编译器自动推导的名称，这也符合 Apple 的命名习惯:</li>
</ul>
<p><em><strong>推荐:</strong></em></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="built_in">NS_ENUM</span>(XYZCollectionViewLayoutMode, <span class="built_in">NSUInteger</span>) &#123;</span><br><span class="line">     XYZCollectionViewLayoutModeGrid,</span><br><span class="line">     XYZCollectionViewLayoutModeFullscreen</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em><strong>不可取:</strong></em></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="built_in">NS_ENUM</span>(XYZCollectionViewLayoutMode, <span class="built_in">NSUInteger</span>) &#123;</span><br><span class="line">     XYZCollectionViewLayoutGridMode,</span><br><span class="line">     XYZCollectionViewLayoutFullscreenMode</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h2><p>在处理 <em>state</em> 而不是 <em>behaviour</em> 时，更加倾向于使用属性而不是方法。</p>
<p><strong>推荐:</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">XYZProfileController</span> : <span class="title">UIViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) XYZProfile *profile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<p><strong>不推荐:</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">XYZProfileController</span> : <span class="title">UIViewController</span></span></span><br><span class="line"></span><br><span class="line">- (XYZProfile *)profile;</span><br><span class="line">- (<span class="keyword">void</span>)setProfile:(XYZProfile *)profile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<ul>
<li>属性声明的格式在 @property 之后应有空格:</li>
</ul>
<p><strong>推荐:</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">XYZPerson</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>, <span class="keyword">readonly</span>) <span class="built_in">NSString</span> *identifier;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><strong>不推荐:</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">XYZPerson</span></span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>,<span class="keyword">copy</span>,<span class="keyword">readonly</span>) <span class="built_in">NSString</span>* identifier;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>@synthesize</code> 和 <code>@dynamic</code> 应该在单独一行上声明实现。</p>
</li>
<li><p>属性名称不要太冗长：不需要指定默认的属性，而应在需要时指定具体的属性，并且记住默认是使用原子属性 <code>atomic</code> 的，在 iOS 中 我们都应该显示指定使用非原子属性 <code>nonatomic</code>。</p>
</li>
</ul>
<p><strong>推荐:</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">XYZPerson</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">NSUInteger</span> numberOfCommonPlaces;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">NSArray</span> *commonPlaces;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">weak</span>) <span class="keyword">id</span>&lt;XYZPersonDelegate&gt; delegate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><strong>不可取:</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">XYZPerson</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">NSUInteger</span> numberOfCommonPlaces; <span class="comment">// NSUInteger 默认使用 `assign`</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>) <span class="built_in">NSArray</span> *commonPlaces; <span class="comment">// 除非确实需要，否则不应该是原子的，默认使用 `atomic`</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="keyword">id</span>&lt;XYZPersonDelegate&gt; delegate; <span class="comment">// 代理需要使用 `weak`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<ul>
<li>原子属性 <code>atomic</code> 使用时需要注意，需要显示标注，这样可以提高其他开发者对此属性性质的可读性和明白其意图。</li>
<li>在属性列表中，优先选择 <code>atomic</code>/<code>nonatomic</code>，放在第一位置，保持代码风格的一致性。</li>
<li>在 <code>dealloc</code> 和 <code>init</code> 方法实现中，我们应该使用 ivars 来访问和修改属性，因为对象在 <code>dealloc</code> 和 <code>init</code> 时，对象有些状态是不确定的。</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">XYZProfile</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)dealloc &#123;</span><br><span class="line">    [_updateTimer invalidate];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (XYZTimer *)updateTimer &#123;</span><br><span class="line">    <span class="keyword">if</span> (!_updateTimer) &#123;</span><br><span class="line">        _updateTimer = [[XYZTimer alloc] init];</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _updateTimer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>有关在 <code>init</code> 方法和 <code>dealloc</code> 方法中使用访问器 <code>Accessor</code> 方法的更多信息，请参见<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/MemoryMgmt/Articles/mmPractical.html#//apple_ref/doc/uid/TP40004447-SW6">此处</a>。</p>
</blockquote>
<h2 id="命名"><a href="#命名" class="headerlink" title="命名"></a>命名</h2><p>应尽可能遵守 Apple 的命名约定，尤其是与<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/MemoryMgmt/Articles/MemoryMgmt.html">内存管理规则</a>有关的约定时。和使用「NARC <code>new</code>、<code>alloc</code>、<code>retain</code>、<code>copy</code>」、<code>create</code> 关键字时，请时刻记住是否需要开发者手动给力内存。</p>
<p>变量名应尽可能取的有意义。除 <code>for()</code> 循环外，应避免单字母变量名称，长的描述性方法和变量名是被允许的。</p>
<p><strong>推荐:</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UIButton</span> *settingsButton;</span><br></pre></td></tr></table></figure>

<p><strong>不推荐:</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UIButton</span> *setBut;</span><br></pre></td></tr></table></figure>
<p>类名、分类「尤其是 <code>Cocoa</code> 的分类」和常量应始终使用三个字母的前缀。常数应为驼峰 <code>camel-case</code> 大小写，所有单词均以大写字母开头，并以相关的类名作为前缀，使其更加清晰。该前缀取决于代码所在的位置，可以是模块前缀也可以是所在层级的结构名称，比如：「PL，BLL，DAL 等」</p>
<p><strong>推荐:</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="built_in">NSTimeInterval</span> XYZProfileViewControllerNavigationFadeAnimationDuration = <span class="number">0.4</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">NSAttributedString</span> (<span class="title">XYZHTMLParsing</span>)</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)XYZ_attributedStringFromHTML:(<span class="built_in">NSString</span> *)string;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<p><strong>不推荐:</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="built_in">NSTimeInterval</span> fadetime = <span class="number">0.2</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">NSAttributedString</span> (<span class="title">HTMLParsing</span>)</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)attributedStringFromHTML:(<span class="built_in">NSString</span> *)string;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<ul>
<li>属性和局部变量应为驼峰式 <code>camel-case</code>，首字母为小写。</li>
<li>实例变量应为驼峰式 <code>camel-case</code>，首字母为小写，并以下划线作为前缀。 </li>
<li>这与 LLVM 自动合成的实例变量一致，如果<strong>LLVM 可以自动合成该变量，则无需处理</strong>。</li>
</ul>
<p><strong>推荐:</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这行代码编译器会自动生成，但是如果我们需要手动生成，则正确写法为：</span></span><br><span class="line"><span class="keyword">@synthesize</span> descriptiveVariableName = _descriptiveVariableName;</span><br></pre></td></tr></table></figure>

<p><strong>不可取:</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">id</span> varnm;</span><br></pre></td></tr></table></figure>

<p>代理方法应始终将调用者 <code>caller</code> 作为第一个参数传递.</p>
<p><strong>推荐:</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)lessonController:(LessonController *)lessonController didSelectLesson:(Lesson *)lesson;</span><br><span class="line">- (<span class="keyword">void</span>)lessonControllerDidFinish:(LessonController *)lessonController;</span><br></pre></td></tr></table></figure>

<p><strong>不推荐:</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)lessonControllerDidSelectLesson:(Lesson *)lesson;</span><br></pre></td></tr></table></figure>

<h2 id="下划线"><a href="#下划线" class="headerlink" title="下划线"></a>下划线</h2><p>使用属性时，应始终使用 <code>self.</code> 来访问和修改实例变量。这意味着所有属性看起来都比较醒目「IDE 关键字颜色」，因为它们都以 <code>self.</code>开头。局部变量不应包含下划线。还有一点值得注意的是使用懒加载技术时，<code>self.</code> 可以完成属性的初始化创建「调用 <code>getter</code> 方法」。</p>
<h2 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h2><p>当需要它们时，应使用注释来解释为什么这段代码会执行这些操作。注意编写注释时，不允许：</p>
<ul>
<li>注释应该简洁明了、禁止表意不明或者注释滥用的情况。</li>
<li>不需要撰写评论的人的姓名，因为版本控制工具已经有记录说明。</li>
<li>不需要有 JIRA 需求链接、BUG 链接但是可以有技术文档链接。</li>
<li>不要注释任何代码，直接删除代码即可，因为这段代码将会在版本控制工具中进行跟踪。</li>
</ul>
<p>通常应避免使用大量注释，因为代码应尽可能表明其意图，仅需要间歇性的几行注释即可「这不适用于生成文档的注释」。在一个方法中包含大量注释意味着开发人员编写的代码逻辑混乱、不严谨。那么首先应该考虑的是重构代码或者梳理代码逻辑，而不是编写大量的注释。</p>
<p>注释对于对外公共的 API 很重要，特别是应用程序平台 API 或可重用代码。这部分代码是提供给其他的开发者使用的，但是同样要记住编写注释的规范和原则。</p>
<p>使用系统 <code>NS_REQUIRES_SUPER</code>、<code>NS_DESIGNATED_INITIALIZER</code>、<code>DEPRECATED_MSG_ATTRIBUTE</code>、<code>DEPRECATED_ATTRIBUTE</code> API 时也需要添加注释。</p>
<h3 id="文档注释"><a href="#文档注释" class="headerlink" title="文档注释"></a>文档注释</h3><p>尽可能只在 .h 文件中使用 Doxygen / AppleDoc 语法完成文档注释。</p>
<p><strong>推荐:</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 启动连接并实现数据转模型，通过 Block 方式回调数据</span></span><br><span class="line"><span class="comment">/// 如果需要自定义数据解析，实现 JSONConvertible 方法即可</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// @param convert 可转换的模型对象</span></span><br><span class="line"><span class="comment">/// @param success 成功回调</span></span><br><span class="line"><span class="comment">/// @param failure 失败回调</span></span><br><span class="line">- (<span class="keyword">void</span>)startWithConvert:(Class)convert</span><br><span class="line">                 success:(<span class="keyword">nullable</span> ConnectTaskBlock)success</span><br><span class="line">                 failure:(<span class="keyword">nullable</span> ConnectTaskBlock)failure;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="协议"><a href="#协议" class="headerlink" title="协议"></a>协议</h2><p>协议语法和代理语法类型:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">XYZPerson</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">BOOL</span>)somethingProtocolMethod;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">XYZMutualAttraction</span> : <span class="title">NSObject</span> &lt;<span class="title">XYZPerson</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">XYZMutualAttraction</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">BOOL</span>)somethingProtocolMethod &#123;</span><br><span class="line"> <span class="comment">// ....</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>优先使用<a href="#%E5%B1%9E%E6%80%A7">属性</a>, 而不是协议中的<a href="#%E6%96%B9%E6%B3%95">方法</a>。</p>
<p><strong>协议「Protocols」</strong>和**<a href="#%E4%BB%A3%E7%90%86">代理</a>「Delegates」** 语法是一致，但是它们还是有细微的区别:</p>
<ul>
<li><code>协议</code> 倾向声明一系列的方法，遵守协议的类负责实现，协议和遵守协议方没有太多关系。</li>
<li><code>协议</code> 方法更多地选择<code>@required</code>。</li>
<li><code>代理</code> 则跟倾向于将自己负责处理的事情交给别的类来做，代理对象和被代理对象存在 <code>拥有</code> 的关系。</li>
<li><code>代理</code> 方法更多地选择<code>@optional</code>。</li>
<li>实际上在 Objective-C 中对此并没有严格限制，但是其中的一些命名规范还是需要遵守的。</li>
</ul>
<h2 id="init-and-dealloc"><a href="#init-and-dealloc" class="headerlink" title="init and dealloc"></a>init and dealloc</h2><p><code>init</code> 方法应该放在实现的顶部，且在 <code>@synthesize</code> 和 <code>@dynamic</code> 语句之后。<code>dealloc</code> 应该直接放在类的 <code>init</code> 方法下面。</p>
<p><code>init</code> 语法结构:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">instancetype</span>)init &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)dealloc &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>对于已声明的 <code>init</code> 方法，即使只有一个，所有类都应该调用 <code>NS_DESIGNATED_INITIALIZER</code> 标识的 <code>init</code> 方法以保证类的正确初始化。</p>
<h2 id="instancetype-vs-id"><a href="#instancetype-vs-id" class="headerlink" title="instancetype vs id"></a>instancetype vs id</h2><ul>
<li>如果不知道 <code>instancetype</code> 是什么？请阅读<a target="_blank" rel="noopener" href="https://nshipster.cn/instancetype/">这份</a>和<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/releasenotes/ObjectiveC/ModernizationObjC/AdoptingModernObjective-C/AdoptingModernObjective-C.html#//apple_ref/doc/uid/TP40014150">这份</a>文档。</li>
<li>对于 <code>init</code> 方法，我们应该使用 Objective-C 2.0 规范，因此请在 <code>init</code> 方法中 <em><strong>始终使用 instancetype</strong></em> 作为返回值类型。</li>
<li>对于工厂方法，有两种情况，这两种方式能够很好的表达便利构造函数。<ul>
<li>当工厂方法可以被子类化时: <em><strong>使用 instancetype</strong></em></li>
<li>当工厂方法不打算被子类化时: <em><strong>使用显示类型</strong></em></li>
</ul>
</li>
</ul>
<h2 id="alloc-init-vs-new"><a href="#alloc-init-vs-new" class="headerlink" title="alloc-init vs new"></a>alloc-init vs new</h2><p>Objective-C 的文件中<br>不要使用 <code>-new</code> 关键字初始化对象, 使用 <code>-alloc</code> 和 <code>-init</code> 链初始化对象:</p>
<p>在 Objective-C++ 的文件中<br>可以使用 <code>-new</code> 关键字初始化对象, 也可以使用 <code>-alloc</code> 和 <code>-init</code> 链初始化对象:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">XYZPerson *person = [[XYZPerson alloc] init]; <span class="comment">// 推荐</span></span><br><span class="line">XYZPerson *person2 = [XYZPerson new]; <span class="comment">// 不推荐</span></span><br></pre></td></tr></table></figure>

<h2 id="字面量"><a href="#字面量" class="headerlink" title="字面量"></a>字面量</h2><p>当创建这些不可变对象实例时，应该使用 <code>NSString</code>、<code>NSDictionary</code>、<code>NSArray</code> 和 <code>NSNumber</code> 字面量来初始化。要特别注意 <code>nil</code> 值不能被传递到 <code>NSArray</code> 和 <code>NSDictionary</code> 字面量中，因为这将会导致崩溃。</p>
<p><strong>推荐:</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSArray</span> *names = @[<span class="string">@&quot;Brian&quot;</span>, <span class="string">@&quot;Matt&quot;</span>, <span class="string">@&quot;Chris&quot;</span>, <span class="string">@&quot;Alex&quot;</span>, <span class="string">@&quot;Steve&quot;</span>, <span class="string">@&quot;Paul&quot;</span>];</span><br><span class="line"><span class="built_in">NSDictionary</span> *productManagers = @&#123;<span class="string">@&quot;iPhone&quot;</span> : <span class="string">@&quot;Kate&quot;</span>, <span class="string">@&quot;iPad&quot;</span> : <span class="string">@&quot;Kamal&quot;</span>, <span class="string">@&quot;Mobile Web&quot;</span> : <span class="string">@&quot;Bill&quot;</span>&#125;;</span><br><span class="line"><span class="built_in">NSNumber</span> *shouldUseLiterals = @YES;</span><br><span class="line"><span class="built_in">NSNumber</span> *buildingZIPCode = @<span class="number">10018</span>;</span><br></pre></td></tr></table></figure>

<p><strong>不可取:</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSArray</span> *names = [<span class="built_in">NSArray</span> arrayWithObjects:<span class="string">@&quot;Brian&quot;</span>, <span class="string">@&quot;Matt&quot;</span>, <span class="string">@&quot;Chris&quot;</span>, <span class="string">@&quot;Alex&quot;</span>, <span class="string">@&quot;Steve&quot;</span>, <span class="string">@&quot;Paul&quot;</span>, <span class="literal">nil</span>];</span><br><span class="line"><span class="built_in">NSDictionary</span> *productManagers = [<span class="built_in">NSDictionary</span> dictionaryWithObjectsAndKeys: <span class="string">@&quot;Kate&quot;</span>, <span class="string">@&quot;iPhone&quot;</span>, <span class="string">@&quot;Kamal&quot;</span>, <span class="string">@&quot;iPad&quot;</span>, <span class="string">@&quot;Bill&quot;</span>, <span class="string">@&quot;Mobile Web&quot;</span>, <span class="literal">nil</span>];</span><br><span class="line"><span class="built_in">NSNumber</span> *shouldUseLiterals = [<span class="built_in">NSNumber</span> numberWithBool:<span class="literal">YES</span>];</span><br><span class="line"><span class="built_in">NSNumber</span> *buildingZIPCode = [<span class="built_in">NSNumber</span> numberWithInteger:<span class="number">10018</span>];</span><br></pre></td></tr></table></figure>

<h2 id="CGRect-函数"><a href="#CGRect-函数" class="headerlink" title="CGRect 函数"></a>CGRect 函数</h2><p>当访问 <code>CGRect</code> 的 <code>x</code>、<code>y</code>、<code>width</code> 或 <code>height</code> 成员时，请使用<a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/coregraphics/cggeometry"><code>CGGeometry</code> 函数</a> 而不是直接访问 struct 成员:</p>
<p><strong>推荐:</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CGRect</span> frame = <span class="keyword">self</span>.view.frame;</span><br><span class="line"></span><br><span class="line"><span class="built_in">CGFloat</span> x = <span class="built_in">CGRectGetMinX</span>(frame);</span><br><span class="line"><span class="built_in">CGFloat</span> y = <span class="built_in">CGRectGetMinY</span>(frame);</span><br><span class="line"><span class="built_in">CGFloat</span> width = <span class="built_in">CGRectGetWidth</span>(frame);</span><br><span class="line"><span class="built_in">CGFloat</span> height = <span class="built_in">CGRectGetHeight</span>(frame);</span><br></pre></td></tr></table></figure>

<p><strong>不推荐:</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CGRect</span> frame = <span class="keyword">self</span>.view.frame;</span><br><span class="line"></span><br><span class="line"><span class="built_in">CGFloat</span> x = frame.origin.x;</span><br><span class="line"><span class="built_in">CGFloat</span> y = frame.origin.y;</span><br><span class="line"><span class="built_in">CGFloat</span> width = frame.size.width;</span><br><span class="line"><span class="built_in">CGFloat</span> height = frame.size.height;</span><br></pre></td></tr></table></figure>

<h2 id="常量"><a href="#常量" class="headerlink" title="常量"></a>常量</h2><p>用常量替代 <code>#define</code> 宏定义，常量类型 IDE 可以检查类型，方便定位错误，也可以使用内联函数和类方法来替代宏定义。</p>
<p><strong>推荐:</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="built_in">CGFloat</span>)thumbnailHeight &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">50.0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="built_in">NSString</span> *)nibName &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">@&quot;XYZDefaultProfileViewController&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="built_in">NSString</span> * <span class="keyword">const</span> XYZDefaultProfileViewControllerNibName = <span class="string">@&quot;nibName&quot;</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="built_in">CGFloat</span> XYZImageThumbnailHeight = <span class="number">50.0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// C/C++</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *kConcurrentQueueName = <span class="string">&quot;com.example.concurrent.queue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Objective-C/Objective-C++</span></span><br><span class="line">FOUNDATION_EXPORT <span class="built_in">NSInteger</span> <span class="keyword">const</span> ConnectTaskCacheNotFoundErrorCode;</span><br><span class="line"><span class="built_in">UIKIT_EXTERN</span> <span class="keyword">const</span> <span class="built_in">CGSize</span> <span class="built_in">UILayoutFittingCompressedSize</span>;</span><br><span class="line"><span class="built_in">UIKIT_EXTERN</span> <span class="built_in">NSNotificationName</span> <span class="keyword">const</span> <span class="built_in">UIApplicationProtectedDataWillBecomeUnavailable</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>不可取:</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> XYZDefaultProfileViewControllerNibName @<span class="meta-string">&quot;nibName&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> XYZImageThumbnailHeight 50.0</span></span><br></pre></td></tr></table></figure>

<h2 id="私有属性"><a href="#私有属性" class="headerlink" title="私有属性"></a>私有属性</h2><p>私有属性应该在类的实现文件的类扩展「匿名类别」中声明。</p>
<p><strong>推荐:</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">XYZAdvertisement</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) GADBannerView *googleAdView;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) ADBannerView *iAdView;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">UIWebView</span> *adXWebView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<h2 id="私有头文件"><a href="#私有头文件" class="headerlink" title="私有头文件"></a>私有头文件</h2><p>私有文件命名格式为：XYZPrivate.h 只能在其他文件的实现文件中引用私有头文件，不能在类的 .h 文件中引用。</p>
<p><strong>推荐:</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Foo.h</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">Bar</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">Baz</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Foo</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) Bar *bar;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">weak</span>) <span class="keyword">id</span>&lt;Baz&gt; baz;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Foo_Private.h</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">&quot;Foo.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">&quot;Bar.h&quot;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&quot;Baz.h&quot;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&quot;Qux.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Foo</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) Qux *qux;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Foo.m</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">&quot;Foo_Private.h&quot;</span></span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// FooTests.m</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">&quot;Foo_Private.h&quot;</span></span></span><br><span class="line">...</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="布尔值"><a href="#布尔值" class="headerlink" title="布尔值"></a>布尔值</h2><p>因为 <code>nil</code> 会被解析为 <code>NO</code> ，所以没有必要在条件中比较它。永远不要直接与 <code>YES</code> 进行比较，因为 <code>YES</code> 被定义为 1，而 <code>BOOL</code> 值最多可以为 8 位。这样可以保持代码的一致性，同样逻辑也更加清晰。</p>
<p><strong>推荐:</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!someObject) &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>不推荐:</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (someObject == <span class="literal">nil</span>) &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p><strong>推荐:</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (isAwesome)</span><br><span class="line"><span class="keyword">if</span> (![someObject boolValue])</span><br></pre></td></tr></table></figure>

<p><strong>不可取:</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (isAwesome == <span class="literal">YES</span>)</span><br><span class="line"><span class="keyword">if</span> ([someObject boolValue] == <span class="literal">NO</span>)</span><br></pre></td></tr></table></figure>

<hr>
<p>如果 <code>BOOL</code> 属性的名字表示为形容词，该属性可以省略 <code>is</code> 前缀，但是通常 <code>get</code> 方法前面会添加 <code>is</code> 前缀，例如:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">getter</span>=isEditable) <span class="built_in">BOOL</span> editable;</span><br></pre></td></tr></table></figure>
<p>示例来源于<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/CodingGuidelines/Articles/NamingIvarsAndTypes.html">Cocoa 编码规范</a>。</p>
<h2 id="代码块"><a href="#代码块" class="headerlink" title="代码块"></a>代码块</h2><p>使用 <code>block</code> 需要注意一些内存问题，从长远来看，这可能会导致应用程序内存泄漏。所以良好的代码风格可以反映出扎实的编码功底并有效地减少可能会出现的问题。当从 <strong>任何的</strong> <code>block</code> 中访问 <code>self</code> 时，<strong>总是</strong>声明一个弱引用 self。</p>
<p><em><strong>推荐:</strong></em></p>
<p>总是使用 self 的若引用，即使这里不会循环引用。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">__<span class="keyword">weak</span> <span class="keyword">typeof</span>(<span class="keyword">self</span>) weakSelf = <span class="keyword">self</span>;</span><br><span class="line">[<span class="built_in">UIView</span> animateWithDuration:(animated ? <span class="number">0.2</span> : <span class="number">0.0</span>) animations:^&#123;</span><br><span class="line">    weakSelf.inputView.hidden = hidden;</span><br><span class="line">    weakSelf.inputView.userInteractionEnabled = !hidden;</span><br><span class="line">    [weakSelf updateTableViewContentInsets];</span><br><span class="line">    [weakSelf updateScrollIndicatorInsets];</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>

<p>或者使用 <code>[libextobjc](https://github.com/jspahrsummers/libextobjc)</code> 库的宏可以非常方便地使用 <code>@weakify/@strongify</code>。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@weakify(<span class="keyword">self</span>);</span><br><span class="line">[<span class="built_in">UIView</span> animateWithDuration:(animated ? <span class="number">0.2</span> : <span class="number">0.0</span>) animations:^&#123;</span><br><span class="line">    @strongify(<span class="keyword">self</span>);</span><br><span class="line">    <span class="keyword">self</span>.inputView.hidden = hidden;</span><br><span class="line">    <span class="keyword">self</span>.inputView.userInteractionEnabled = !hidden;</span><br><span class="line">    [<span class="keyword">self</span> updateTableViewContentInsets];</span><br><span class="line">    [<span class="keyword">self</span> updateScrollIndicatorInsets];</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>

<p><em><strong>禁止:</strong></em></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[<span class="built_in">UIView</span> animateWithDuration:(animated ? <span class="number">0.2</span> : <span class="number">0.0</span>) animations:^&#123;</span><br><span class="line">    <span class="keyword">self</span>.inputView.hidden = hidden;</span><br><span class="line">    <span class="keyword">self</span>.inputView.userInteractionEnabled = !hidden;</span><br><span class="line">    [<span class="keyword">self</span> updateTableViewContentInsets];</span><br><span class="line">    [<span class="keyword">self</span> updateScrollIndicatorInsets];</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>

<h2 id="单例"><a href="#单例" class="headerlink" title="单例"></a>单例</h2><p>通常尽可能避免使用它们，而应使用依赖项注入「NS_DESIGNATED_INITIALIZER 方法」。有必要的话所需的单例对象应使用线程安全模式来创建其共享实例</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="keyword">instancetype</span>)sharedInstance &#123;</span><br><span class="line">   <span class="keyword">static</span> <span class="keyword">id</span> sharedInstance = <span class="literal">nil</span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</span><br><span class="line">   <span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</span><br><span class="line">      sharedInstance = [[<span class="keyword">self</span> alloc] init];</span><br><span class="line">   &#125;);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> sharedInstance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这么操作可以防止可能发生的崩溃，因为 <code>dispatch_once</code> 本身是多线程安全的。</p>
<h2 id="Xcode-项目"><a href="#Xcode-项目" class="headerlink" title="Xcode 项目"></a>Xcode 项目</h2><p>如果条件允许，请<strong>始终</strong>在 Target 的 “Build Settings” 中打开 “Treat Warnings as Errors”「GCC_TREAT_WARNINGS_AS_ERRORS」，并启用尽可能多的其他警告。如果您需要忽略特定警告，请使用 <a target="_blank" rel="noopener" href="http://clang.llvm.org/docs/UsersManual.html#controlling-diagnostics-via-pragmas">Clang’s pragma feature</a>。</p>
<h2 id="代码格式化"><a href="#代码格式化" class="headerlink" title="代码格式化"></a>代码格式化</h2><p><strong>始终</strong>启用 clang-format 插件格式化代码。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入项目根目录下执行命令</span></span><br><span class="line">sh <span class="string">&quot;tools/spacecommander/format-objc-files-in-repo.sh&quot;</span> <span class="comment"># 格式化整个项目</span></span><br><span class="line">sh <span class="string">&quot;tools/spacecommander/format-objc-files.sh -s&quot;</span> <span class="comment"># 提交代码时格式化所有不符合规范的文件</span></span><br><span class="line">sh <span class="string">&quot;tools/spacecommander/format-objc-file.sh &#123;#FILEPATH&#125;&quot;</span> <span class="comment"># 提交代码时格式化单个不符合规范的文件</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN,en,default">
    <link itemprop="mainEntityOfPage" href="https://l1dan.github.io/2020/08/01/2020-08-01-install-software-in-archlinux/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="李丹(l1dan@hotmail.com)">
      <meta itemprop="description" content="帮助自己成长，如有不对还望斧正。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="l1Dan's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/08/01/2020-08-01-install-software-in-archlinux/" class="post-title-link" itemprop="url">Arch Linux 软件安装</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-08-01 18:06:56" itemprop="dateCreated datePublished" datetime="2020-08-01T18:06:56+08:00">2020-08-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-23 21:35:26" itemprop="dateModified" datetime="2021-05-23T21:35:26+08:00">2021-05-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%B3%BB%E7%BB%9F/" itemprop="url" rel="index"><span itemprop="name">系统</span></a>
                </span>
            </span>

          
            <span id="/2020/08/01/2020-08-01-install-software-in-archlinux/" class="post-meta-item leancloud_visitors" data-flag-title="Arch Linux 软件安装" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2020/08/01/2020-08-01-install-software-in-archlinux/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/08/01/2020-08-01-install-software-in-archlinux/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="安装软件篇"><a href="#安装软件篇" class="headerlink" title="安装软件篇"></a>安装软件篇</h1><h2 id="一、安装系统软件"><a href="#一、安装系统软件" class="headerlink" title="一、安装系统软件"></a>一、安装系统软件</h2><p>进入之后会发现两个问题：</p>
<ol>
<li>终端模拟器没有，通过 <code>sudo pacmam -S Konsole</code> 安装</li>
<li>桌面无法正常缩放（VirtualBox 需要），通过 <code>sudo pacman -S virtualbox-guest-utils</code> 安装。</li>
</ol>
<p>这个时候还会发现，要执行命令，就需终端模拟器，要安装终端模拟器就需要执行安装<code>sudo pacmam -S Konsole</code>命令，这就陷入死循环了，那么怎么办？<br>办法1：在安装桌面套件是随便把终端模拟器安装了，但是现在已经没办法安装了。<br>办法2：重新安装一边系统，记得把终端模拟器安装了（不可取）。<br>办法3：使用 Archiso 镜像进入安装系统流程，挂载 /mnt 之后安装终端模拟器（费劲）。<br>办法4：UEFI启动界面时进入字符界面安装终端模拟器（也费劲）。<br>办法5：<br>    1. 在现在启动的图形桌面环境下按 <code>Ctrl+Alt+F3</code> 组合安装进入字符终端。<br>    2. 执行 <code>sudo pacman -Syyu</code> 更新<br>    2. 执行 <code>sudo pacmam -S Konsole</code> 命令。<br>    3. 按下 Ctrl+Alt+F1 回到图形界面。完成安装。</p>
<h3 id="记得安装-vbox-工具（VirtualBox-需要）"><a href="#记得安装-vbox-工具（VirtualBox-需要）" class="headerlink" title="记得安装 vbox 工具（VirtualBox 需要）"></a>记得安装 vbox 工具（VirtualBox 需要）</h3><p><code>sudo pacman -S virtualbox-guest-utils</code></p>
<p>查看 boxservice.service 服务是否启动<br><code>systemctl list-unit-files | grep vbox</code> 如果第一项为 disable 则执行如下命令：<br>    1. <code>sudo systemctl enable vboxservice.service</code> 启用 vbox 服务<br>    2. <code>reboot</code> 重启就可以使用了。</p>
<h3 id="一个很重要的软件！！！"><a href="#一个很重要的软件！！！" class="headerlink" title="一个很重要的软件！！！"></a>一个很重要的软件！！！</h3><p>接下来我们安装一个很重要的软件执行如下命令：<br>    1. <code>sudo pacman -S screenfetch</code><br>    2. screenfetch</p>
<p>相信你们看到什么了，没错就是下面这样的，没别的意思，就是想显摆下，满足下虚荣心。好了，装逼装完了，继续安装软件。</p>
<h3 id="文件管理器"><a href="#文件管理器" class="headerlink" title="文件管理器"></a>文件管理器</h3><p>如果你一步一步跟到这里了，可能还没发现一个问题，就是竟然没找到文件管理器。安装Dolphin文件管理：<br><code>sudo pacman -S dolphin</code></p>
<h3 id="文件夹"><a href="#文件夹" class="headerlink" title="文件夹"></a>文件夹</h3><p>进入 Dolphin 会发现很多默认文件夹都没有，需要自己生成默认文件夹：<br>    1. <code>sudo pacman -S xdg-user-dirs</code><br>    2. <code>sudo xdg-user-dirs-update</code><br>    3. <code>reboot</code> 重启之后打开 Dolphin 就可以看到默认文件夹了</p>
<h3 id="安装软件图标主题（可选安装）"><a href="#安装软件图标主题（可选安装）" class="headerlink" title="安装软件图标主题（可选安装）"></a>安装软件图标主题（可选安装）</h3><p>如果看腻了原生的图标，也可以安装一套自己喜欢的图标，配合 KDE 的深色模式食用更佳。<br><code>sudo pacman -S papirus-icon-theme</code></p>
<h2 id="二、安装常用桌面软件"><a href="#二、安装常用桌面软件" class="headerlink" title="二、安装常用桌面软件"></a>二、安装常用桌面软件</h2><h3 id="配置国内源"><a href="#配置国内源" class="headerlink" title="配置国内源"></a>配置国内源</h3>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN,en,default">
    <link itemprop="mainEntityOfPage" href="https://l1dan.github.io/2020/07/25/2020-07-25-install-archlinux-in-virtualbox/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="李丹(l1dan@hotmail.com)">
      <meta itemprop="description" content="帮助自己成长，如有不对还望斧正。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="l1Dan's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/07/25/2020-07-25-install-archlinux-in-virtualbox/" class="post-title-link" itemprop="url">VirtualBox 安装最新 Arch Linux</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-07-25 10:06:56" itemprop="dateCreated datePublished" datetime="2020-07-25T10:06:56+08:00">2020-07-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-23 21:35:26" itemprop="dateModified" datetime="2021-05-23T21:35:26+08:00">2021-05-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%B3%BB%E7%BB%9F/" itemprop="url" rel="index"><span itemprop="name">系统</span></a>
                </span>
            </span>

          
            <span id="/2020/07/25/2020-07-25-install-archlinux-in-virtualbox/" class="post-meta-item leancloud_visitors" data-flag-title="VirtualBox 安装最新 Arch Linux" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2020/07/25/2020-07-25-install-archlinux-in-virtualbox/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/07/25/2020-07-25-install-archlinux-in-virtualbox/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id=""><a href="#" class="headerlink" title=""></a><img src="/images/2020/13-archlinux-logo.png"></h2><h1 id="安装系统篇"><a href="#安装系统篇" class="headerlink" title="安装系统篇"></a>安装系统篇</h1><h2 id="一、准备安装环境"><a href="#一、准备安装环境" class="headerlink" title="一、准备安装环境"></a>一、准备安装环境</h2><ul>
<li>Wi-Fi 或 有线网络（保证 VritualBox 可以正常联网）</li>
<li>macOS 10.15.6</li>
<li><a target="_blank" rel="noopener" href="https://www.virtualbox.org/wiki/Downloads">下载 VirtualBox 和 Oracle VM VirtualBox Extension Pack</a></li>
<li><a target="_blank" rel="noopener" href="https://www.archlinux.org/download/">下载 Arch Linux ISO 文件</a></li>
</ul>
<p><strong>注意</strong>：在 VirtualBox 新建虚拟机需要打开 EFI 选项<br>   <code>Settings -&gt; System -&gt; Motherboard 勾选 Extended Features Enable EFI (special OSes only)</code><br>   <img src="/images/2020/01-settings-uefi.png"></p>
<h2 id="二、预备安装"><a href="#二、预备安装" class="headerlink" title="二、预备安装"></a>二、预备安装</h2><h3 id="验证启动模式"><a href="#验证启动模式" class="headerlink" title="验证启动模式"></a>验证启动模式</h3><p>Archiso 使用 systemd-boot 和 syslinux 分别在 UEFI模式 和 BIOS 模式下启动。<br>要验证启动模式，可以使用下列命令列出 efivars 目录：</p>
<p><code>ls /sys/firmware/efi/efivars</code></p>
<p>如果没有出错且显示了目录，则系统以 UEFI 模式启动。反之，则系统可以是以 BIOS 模式或其他模式启动。</p>
<p><em>提示：在 (Like) Linux 或 (Like) Unix 系统下 SHELL 环境的命令可以使用 <code>Tab</code> 按键补全。</em><br><strong>注意</strong>：这里是选择 UEFI 启动模式安装的，如果上述命令出错，请检查虚拟机 EFI 设置是否有问题。</p>
<h3 id="连接到网络"><a href="#连接到网络" class="headerlink" title="连接到网络"></a>连接到网络</h3><ol>
<li>使用 <code>ip link</code> 命令检查系统是否启用了网络接口。</li>
<li>有线网络插上网线就可以（VritualBox 可以跳过）。</li>
<li>Wi-Fi 网络使用 <code>iwctl</code> 验证无线网络（VritualBox 可以跳过）。</li>
<li>使用 Ping 检查网络连接 <code>ping -c 3 archlinux.org</code>。</li>
</ol>
<p><strong>注意：</strong> Archiso 安装镜像默认是已经启用 <code>systemd-network.service</code>、<code>systemd-resolved.service</code> 和 <code>iwd.service</code>。所以这里的网络设置可以跳过，但是后面安装好的系统这些工具是没有的，需要自己安装和配置。</p>
<h3 id="更新系统时间"><a href="#更新系统时间" class="headerlink" title="更新系统时间"></a>更新系统时间</h3><p><code>timedatectl set-ntp true</code><br>检查服务状态 <code>timedatectl status</code>。</p>
<h3 id="建立硬盘分区"><a href="#建立硬盘分区" class="headerlink" title="建立硬盘分区"></a>建立硬盘分区</h3><p>这里采用 <code>parted</code> 命令分区和 UEFI 分区方案。<br>查看当前磁盘信息有几种方式：</p>
<ol>
<li><code>lsblk</code> 2. <code>parted /dev/sda print</code> 3. <code>fdisk -l /dev/sda</code></li>
</ol>
<h3 id="开始分区"><a href="#开始分区" class="headerlink" title="开始分区"></a>开始分区</h3><p>分区方案是：boot = 200Mib，swap ～= 8G，root ～= 22G，剩下的分给 home 分区。下面是分区步骤：</p>
<ol>
<li><code>parted /dev/sda</code> 进入分区模式。</li>
<li><code>mktable gpt</code> 采用 <code>gpt</code> 分区表（存放引导文件）。</li>
<li><code>mkpart boot fat32 1M 200M</code> 建立 <code>boot</code> 分区。</li>
<li><code>mkpart swap linux-swap 200M 8G</code> 建立 <code>swap</code> 分区（如果实体机采用固态硬盘+ &gt;= 8G RAM 方式可以不用建立 swap 分区）。</li>
<li><code>mkpart root ext4 8G 30G</code> 建立 <code>root</code> 分区。</li>
<li><code>mkpart home ext4 30G 100%</code> 建立 <code>home</code> 分区（100% 表示使用所有剩下的可用空间）。</li>
<li><code>print</code> 查看分区信息是否正确。</li>
<li><code>quit</code> 退出分区模式。</li>
</ol>
<h3 id="格式化分区"><a href="#格式化分区" class="headerlink" title="格式化分区"></a>格式化分区</h3><ol>
<li><code>mkfs.fat -F32 /dev/sda1</code> 格式化 boot 分区。</li>
<li><code>mkswap /dev/sda2</code> 格式化 swap 分区。</li>
<li><code>mkfs.ext4 /dev/sda3</code> 格式化 root 分区。</li>
<li><code>mkfs.ext4 /dev/sda4</code> 格式化 home 分区。</li>
</ol>
<h3 id="挂在分区"><a href="#挂在分区" class="headerlink" title="挂在分区"></a>挂在分区</h3><ol>
<li><code>mount /dev/sda3 /mnt</code> 首先挂载 root 分区。</li>
<li><code>mkdir /mnt/efi &amp;&amp; mount /dev/sda1 /mnt/efi</code> 创建 efi 文件夹并挂载 boot 分区。</li>
<li><code>mkdir /mnt/home &amp;&amp; mount /dev/sda4 /mnt/home</code> 创建 home 文件夹并挂载 home 分区。</li>
</ol>
<h2 id="三、系统安装"><a href="#三、系统安装" class="headerlink" title="三、系统安装"></a>三、系统安装</h2><h3 id="选择镜像源"><a href="#选择镜像源" class="headerlink" title="选择镜像源"></a>选择镜像源</h3><p>Archiso Live 系统会自动执行 <code>reflector</code> 命令来帮你选择镜像源，所以选择镜像源这一步可以直接跳过。<br>刷新源 <code>pacman -Syy</code></p>
<h3 id="安装必须软件包"><a href="#安装必须软件包" class="headerlink" title="安装必须软件包"></a>安装必须软件包</h3><p><code>pacstrap /mnt base linux linux-firmware</code> 使用 <code>pacstrap</code> 脚本安装基础软件包和硬件固件。</p>
<h3 id="配置系统"><a href="#配置系统" class="headerlink" title="配置系统"></a>配置系统</h3><p>使用以下命令生成 fstab 文件。</p>
<p><code>genfstab -U /mnt &gt;&gt; /mnt/etc/fstab</code></p>
<p>查看配置是否正确。</p>
<p><code>cat /mnt/etc/fstab</code></p>
<h3 id="进入刚刚安装的系统"><a href="#进入刚刚安装的系统" class="headerlink" title="进入刚刚安装的系统"></a>进入刚刚安装的系统</h3><p><code>arch-chroot /mnt</code></p>
<h3 id="时区"><a href="#时区" class="headerlink" title="时区"></a>时区</h3><ol>
<li><code>ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</code> 设置时区。</li>
<li><code>hwclock --systohc</code> 设置硬件时间。</li>
<li><code>date</code> 查看日期时间是否正确。</li>
</ol>
<h3 id="安装文本编辑器（新系统默认没有任何编辑器）"><a href="#安装文本编辑器（新系统默认没有任何编辑器）" class="headerlink" title="安装文本编辑器（新系统默认没有任何编辑器）"></a>安装文本编辑器（新系统默认没有任何编辑器）</h3><p>pacman -S vim</p>
<p><em>提示：Vim 基本操作。</em><br><code>vim /path/file.ext</code>  进入编辑指定文件。<br>查找操作：normal 模式下输入 <code>/</code> 后面输入查找字符。<br>删除光标所在的字符或单词：<code>dw</code>。<br>进入编辑模式：<code>i</code>。<br>退出编辑模式：<code>esc</code>。<br>撤销上一步操作：<code>u</code>。<br>退出 Vim 并保存文件：<code>wq</code>。<br>强制退出，不做任何操作：<code>q!</code>。</p>
<h3 id="本地化设置"><a href="#本地化设置" class="headerlink" title="本地化设置"></a>本地化设置</h3><ol>
<li>使用 <code>vim /etc/locale.gen</code>，将 <code>/etc/locale.gen</code> 中 <code>en_US.UTF-8</code> 和 <code>zh_CN.UTF-8</code> 的注释去掉。</li>
<li><code>locale-gen</code> 生成 locale 信息。</li>
<li>使用 <code>vim /etc/locale.conf</code>，在文件 <code>/etc/locale.conf </code> 中写入 <code>LANG=en_US.UTF-8</code> 配置</li>
</ol>
<p><strong>注意：</strong> </p>
<ol>
<li>不要在 <code>/etc/locale.conf</code> 文件中配置为中文 locale，会导致 TTY 乱码。</li>
<li>可以在 <code>/etc/locale.conf</code> 中添加 <code>LANGUAGE=en_US:en_GB:en</code> 配置。</li>
</ol>
<h3 id="网络配置"><a href="#网络配置" class="headerlink" title="网络配置"></a>网络配置</h3><p>创建 hostname 文件并设置主机名<br><code>echo myhostname &gt; /etc/hostname</code></p>
<p>配置 hosts 文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vim &#x2F;etc&#x2F;hosts</span><br><span class="line"></span><br><span class="line"># 输入以下内容</span><br><span class="line">127.0.0.1	localhost</span><br><span class="line">::1			localhost</span><br><span class="line">127.0.1.1	myhostname.localdomain.myhostname</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：<code>myhostname</code> 设置为你喜欢的名字。</p>
<h3 id="设置-Root-密码"><a href="#设置-Root-密码" class="headerlink" title="设置 Root 密码"></a>设置 Root 密码</h3><p><code>password</code> 设置 root 用户密码。</p>
<h3 id="创建新用户"><a href="#创建新用户" class="headerlink" title="创建新用户"></a>创建新用户</h3><p>添加用户 useradd -m -g “初始组” -G “附加组” -s “登陆shell” “用户”<br>将新建用户移入wheel组并指定shell为zsh (以后可修改)</p>
<ol>
<li><code>pacman -S zsh</code> 安装 zsh (Arch Linux 默认就是使用 zsh)。</li>
<li>useradd -m -G wheel -s /bin/bash username 创建一个名为 username 的新用户。</li>
<li>password username 设置用户名为 username 的密码。</li>
</ol>
<h3 id="添加管理员权限"><a href="#添加管理员权限" class="headerlink" title="添加管理员权限"></a>添加管理员权限</h3><ol>
<li><code>pacman -S sudo</code> 安装 sudo 命令，会自动生成 sudoers 文件。</li>
<li>将文 件/etc/sudoers 中的 <code>%wheel ALL=(ALL) ALL</code> 前面的注释去掉。</li>
</ol>
<p><em>提示：</em> 如果 <code>/etc/sudoers</code> 文件为只读默认，无法修改的话可以做以下操作：</p>
<ol>
<li><code>chmod +w /etc/sudoers</code> 将文件添加一个可写的权限。</li>
<li><code>vim /etc/sudoers</code> 修改文件。</li>
<li><code>chmod 0440 /etc/sudoers</code> 还原会原来的自读权限。</li>
</ol>
<h3 id="安装和配置-UEFI-引导系统"><a href="#安装和配置-UEFI-引导系统" class="headerlink" title="安装和配置 UEFI 引导系统"></a>安装和配置 UEFI 引导系统</h3><ol>
<li><code>pacman -S grub efibootmgr</code></li>
<li>执行以下命令：<br><code>grub-install --target=x86_64-efi --efi-directory=/efi --bootloader-id=ArchLinux</code></li>
<li>使用生成grub配置文件：<br><code>grub-mkconfig -o /boot/grub/grub.cfg</code></li>
</ol>
<p><em>其实到这里就可以进入系统了，但是为了避免后面麻烦，还需要安装一些额外的软件工具。</em></p>
<h2 id="四、配置桌面环境"><a href="#四、配置桌面环境" class="headerlink" title="四、配置桌面环境"></a>四、配置桌面环境</h2><h3 id="安装网络相关工具"><a href="#安装网络相关工具" class="headerlink" title="安装网络相关工具"></a>安装网络相关工具</h3><ol>
<li><code>pacman -S iwd wpa_supplicant dialog networkmanager dhcpcd</code></li>
<li>启动服务 <code>systemctl enable NetworkManager &amp;&amp; systemctl enable dhcpcd</code></li>
</ol>
<h3 id="安装声音相关软件包"><a href="#安装声音相关软件包" class="headerlink" title="安装声音相关软件包"></a>安装声音相关软件包</h3><p><code>pacman -S alsa-utils pulseaudio pulseaudio-alsa</code></p>
<h3 id="安装字体"><a href="#安装字体" class="headerlink" title="安装字体"></a>安装字体</h3><p><code>pacman -S ttf-dejavu wqy-microhei</code></p>
<h3 id="安装桌面套件"><a href="#安装桌面套件" class="headerlink" title="安装桌面套件"></a>安装桌面套件</h3><ol>
<li><code>pacman -S xorg</code> 安装 Xorg</li>
<li><code>pacman -S plasma</code> 安装桌面（不要安装 kde-applications，太多不需要的软件，后面可以自己选装。）</li>
<li><code>systemctl enable sddm</code> 激活登陆窗口 sddm。</li>
</ol>
<h3 id="重启系统，进入桌面环境"><a href="#重启系统，进入桌面环境" class="headerlink" title="重启系统，进入桌面环境"></a>重启系统，进入桌面环境</h3><ol>
<li><code>exit</code> 退出到 Archiso 镜像安装 SHELL 界面。</li>
<li><code>umount -R /mnt</code> 卸载 /mnt</li>
<li><code>reboot</code> 重启系统</li>
</ol>
<h2 id="完结"><a href="#完结" class="headerlink" title="完结"></a>完结</h2><p>Arch Linux 系统的安装基本就完成了，接下来就是系统基本配置和常用软件的安装了，可以看下一篇，常用软件的安装。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN,en,default">
    <link itemprop="mainEntityOfPage" href="https://l1dan.github.io/2017/05/01/2017-05-01-xcode-run-script/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="李丹(l1dan@hotmail.com)">
      <meta itemprop="description" content="帮助自己成长，如有不对还望斧正。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="l1Dan's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/05/01/2017-05-01-xcode-run-script/" class="post-title-link" itemprop="url">利用Shell和Xcode做些有趣的事</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-05-01 18:06:56" itemprop="dateCreated datePublished" datetime="2017-05-01T18:06:56+08:00">2017-05-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-23 21:35:26" itemprop="dateModified" datetime="2021-05-23T21:35:26+08:00">2021-05-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9D%82%E8%B0%88/" itemprop="url" rel="index"><span itemprop="name">杂谈</span></a>
                </span>
            </span>

          
            <span id="/2017/05/01/2017-05-01-xcode-run-script/" class="post-meta-item leancloud_visitors" data-flag-title="利用Shell和Xcode做些有趣的事" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2017/05/01/2017-05-01-xcode-run-script/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/05/01/2017-05-01-xcode-run-script/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="/images/2017/xcode-run-script-header.png" alt="image1"></p>
<p>Shell 在计算机里的作用是用来提供使用</p>
<p>Xcode Run Script 里面的脚本代码的作用时机是在Build期间。在这期间我们到底可以做些什么呢？这就需要我们各自发挥自己的想象力了，这里就拿几个实用的例子看下效果。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2017/05/01/2017-05-01-xcode-run-script/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN,en,default">
    <link itemprop="mainEntityOfPage" href="https://l1dan.github.io/2016/07/23/2016-07-23-swift-using-generice/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="李丹(l1dan@hotmail.com)">
      <meta itemprop="description" content="帮助自己成长，如有不对还望斧正。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="l1Dan's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/07/23/2016-07-23-swift-using-generice/" class="post-title-link" itemprop="url">Swift泛型</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-07-23 18:27:03" itemprop="dateCreated datePublished" datetime="2016-07-23T18:27:03+08:00">2016-07-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-23 21:35:26" itemprop="dateModified" datetime="2021-05-23T21:35:26+08:00">2021-05-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a>
                </span>
            </span>

          
            <span id="/2016/07/23/2016-07-23-swift-using-generice/" class="post-meta-item leancloud_visitors" data-flag-title="Swift泛型" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2016/07/23/2016-07-23-swift-using-generice/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2016/07/23/2016-07-23-swift-using-generice/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>泛型是程序设计语言的一种特性。它能够根据使用者自定义的需求编写出适用于任意类型并且灵活可复用的组件。使用泛型可以避免代码的重复编写，可以使代码更加清晰，能让使用者的想象发挥到极致。泛型是<code>Swift</code>的一个重要的特性，在<code>Swift</code>标准库中也大量运用了这个特性。比如我们经常使用的字典<code>Dictionary&lt;Key : Hashable, Value&gt;</code>还有数组<code>Array&lt;Element&gt;</code>，你可以使用任意类型来创建字典和数组，这就是泛型强大之处。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2016/07/23/2016-07-23-swift-using-generice/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN,en,default">
    <link itemprop="mainEntityOfPage" href="https://l1dan.github.io/2016/06/16/2016-06-16-swift-using-closure/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="李丹(l1dan@hotmail.com)">
      <meta itemprop="description" content="帮助自己成长，如有不对还望斧正。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="l1Dan's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/06/16/2016-06-16-swift-using-closure/" class="post-title-link" itemprop="url">Swift闭包</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-06-16 23:11:24" itemprop="dateCreated datePublished" datetime="2016-06-16T23:11:24+08:00">2016-06-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2016-10-30 19:51:00" itemprop="dateModified" datetime="2016-10-30T19:51:00+08:00">2016-10-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a>
                </span>
            </span>

          
            <span id="/2016/06/16/2016-06-16-swift-using-closure/" class="post-meta-item leancloud_visitors" data-flag-title="Swift闭包" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2016/06/16/2016-06-16-swift-using-closure/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2016/06/16/2016-06-16-swift-using-closure/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <!-- 这里的日期要注意不能大于今天 -->

<h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p>闭包是自包含的函数代码块，可以在代码中被传递和使用。闭包可以捕获和存储其所在上下文中任意常量和变量的引用。这就是所谓的闭合并包裹着这些常量和变量，俗称闭包。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2016/06/16/2016-06-16-swift-using-closure/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="李丹(l1dan@hotmail.com)"
      src="/images/avatar.jpeg">
  <p class="site-author-name" itemprop="name">李丹(l1dan@hotmail.com)</p>
  <div class="site-description" itemprop="description">帮助自己成长，如有不对还望斧正。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">6</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/l1Dan" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;l1Dan" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:l1Dan@hotmail.com" title="E-Mail → mailto:l1Dan@hotmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2016 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">李丹(l1dan@hotmail.com)</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'Of0luUUTAuJkW9h7x78FM3cm-MdYXbMMI',
      appKey     : 'n9h1cNSngrgulr82NcWmlUTo',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
